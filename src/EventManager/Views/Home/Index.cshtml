@model IEnumerable<EventManager.Models.Event>
@inject UserManager<ApplicationUser> UserManager
@inject SignInManager<ApplicationUser> SignInManager
<h1 class="jumbotron"><span class="glyphicon glyphicon-search"></span>&nbsp; Event Manager</h1>
@if (SignInManager.IsSignedIn(User) && string.IsNullOrEmpty(UserManager.Users.SingleOrDefault(u => u.UserName == User.Identity.Name).Name))
{
    <form class="form-inline">
        <div class="form-group">
            <input type="search" name="search" />
        </div>
        <button type="submit" class="btn btn-info btn-sm">Search</button>
        @if (!string.IsNullOrEmpty(ViewBag.Search))
        {
            <a asp-controller="Events" asp-action="UserIndex" class="btn btn-sm btn-danger">All Events</a>
        }
    </form>
    @foreach (var show in Model)
    {
        <h4><b>@show.Artist.Name</b></h4>
        <div class="main">
            <div class="left">
                <div class="upperleft">@show.Venue</div>
                <div><b>@show.Genre.Name</b></div>
            </div>
            <div class="right">
                <div><big><b>@show.Date.ToString("MMM")</b></big></div>
                <div>@show.Date.ToString("dd")</div>
            </div>
        </div>
        <br />
        if (show.Users.Any(u => u.UserID == UserManager.Users.SingleOrDefault(n => n.UserName == User.Identity.Name).Id))
        {
            <a class="btn btn-sm btn-success" asp-controller="Events" asp-action="Unattend" asp-route-id="@show.EventID">Attending</a>
        }
        else
        {
            <a class="btn btn-sm btn-default" asp-controller="Events" asp-action="Reserve" asp-route-id="@show.EventID">Reserve Seat</a>
        }
        <br /><br />
    }
}
else
{
    <h2><big>All Upcoming Events</big></h2>
    @foreach (var show in Model)
    {
        <h4><b>@show.Artist.Name</b></h4>
        <div class="main">
            <div class="left">
                <div class="upperleft">@show.Venue</div>
                <div><b>@show.Genre.Name</b></div>
            </div>
            <div class="right">
                <div><big><b>@show.Date.ToString("MMM").ToUpper()</b></big></div>
                <div>@show.Date.ToString("dd")</div>
            </div>
        </div>
        <br /><br />
    }
}
  
